# # events {
# #     worker_connections  1024;
# # }
# # http {
# #     include       /etc/nginx/mime.types;
# #     default_type  application/octet-stream;

# #     server {
# #         listen 80;
# #         server_name _;

# #         root /usr/share/nginx/html;
# #         index index.html;

# #         # favicon
# #         location = /favicon.ico {
# #             log_not_found off;
# #             access_log off;
# #         }

# #         # Proxy vers ton backend public Railway
# #         location /api/ {
# #             proxy_pass https://woofwalksback-prod-production.up.railway.app/api/;
# #             proxy_set_header Host $host;
# #             proxy_set_header X-Real-IP $remote_addr;
# #             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
# #         }

# #         # Fichiers statiques
# #         location ~* \.(css|js|jpg|jpeg|png|gif|svg|ico)$ {
# #             expires 30d;
# #             add_header Cache-Control "public";
# #         }

# #         # React SPA → index.html
# #         location / {
# #             try_files $uri $uri/ /index.html;
# #         }
# #     }
# # }
# # nginx.conf pour le frontend
# events {
#     worker_connections  1024;
# }
# http {
#     include       /etc/nginx/mime.types;
#     default_type  application/octet-stream;
    
#     server {
#         listen 80;
#         server_name _;

#         root /usr/share/nginx/html;
#         index index.html;

#         # Sécurité: Ajout des en-têtes cruciaux
#         add_header X-Content-Type-Options nosniff always;
#         add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
#         add_header X-XSS-Protection "1; mode=block" always;
#         add_header Content-Security-Policy "default-src 'self' 'unsafe-eval'; connect-src 'self' https://woofwalksback-prod-production.up.railway.app; style-src 'self' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https://www.gravatar.com; frame-ancestors 'none';" always;
#         add_header Cache-Control "no-store, no-cache, must-revalidate, max-age=0" always;
#         add_header Referrer-Policy "no-referrer" always;
#         add_header Permissions-Policy "camera=(), microphone=(), geolocation=()" always;
#         server_tokens off;

#         # React SPA - Toutes les requêtes qui ne correspondent pas à un fichier sont envoyées à index.html
#         location / {
#             try_files $uri $uri/ /index.html;
#         }
#     }
# }

events {
    worker_connections  1024;
}
http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;
    
    server {
        listen 80;
        server_name _;
        
        # Sécurité : Ajout des en-têtes pour le front-end
        add_header X-Content-Type-Options nosniff always;
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
        add_header X-XSS-Protection "1; mode=block" always;
        add_header Content-Security-Policy "default-src 'self' 'unsafe-eval'; connect-src 'self' https://woofwalksback-prod-production.up.railway.app; style-src 'self' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https://www.gravatar.com; frame-ancestors 'none';" always;
        add_header Cache-Control "no-store, no-cache, must-revalidate, max-age=0" always;
        add_header Referrer-Policy "no-referrer" always;
        add_header Permissions-Policy "camera=(), microphone=(), geolocation=()" always;
        server_tokens off;

        root /usr/share/nginx/html;
        index index.html;

        # Proxy vers le back-end de l'API sur Railway
        location /api/ {
            # Assurez-vous que cette URL est correcte et publique
            proxy_pass https://woofwalksback-prod-production.up.railway.app/api/;
            proxy_redirect off;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            # Ces headers sont essentiels pour que Symfony derrière le proxy reconnaisse la requête comme HTTPS
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Forwarded-Host $host;
        }

        # Pour les fichiers statiques (images, CSS, JS)
        location ~* \.(css|js|jpg|jpeg|png|gif|svg|ico)$ {
            expires 30d;
            add_header Cache-Control "public";
        }
        
        # Gère le routage de l'application React
        location / {
            try_files $uri $uri/ /index.html;
        }
    }
}